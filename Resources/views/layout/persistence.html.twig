{% extends 'blank'|twig('layout') %}
{% set tpl_content_class = ['bsw-page-container', tpl_content_class_diy ?? null]|filter(v => v)|join(' ') %}

{% block page %}
  <div class="bsw-persistence">
    <a-form
      id="persistence_form"
      :form="persistence_form"
      :style='{{ persistence.styleJson|raw }}'
      @submit="persistence_submit"
    >
      {% set total_column = constant(scaffold.abs ~ "::PERSISTENCE_TOTAL_COLUMN") %}
      {% set label_column = constant(scaffold.abs ~ "::PERSISTENCE_LABEL_COLUMN") %}

      {% set small = scaffold.iframe ? 'sm' : 'md' %}
      {% set large = scaffold.iframe ? 'md' : 'lg' %}

      {% for field, item in persistence.record %}
        {% set form = item.type %}
        {% set wrapper_column = item.column ?: (total_column - label_column) %}
        {% set meta = "persistence_field_shape_now." ~ field %}
        <transition name="bsw">
          <a-form-item
            v-show="typeof {{ meta }} !== 'undefined' ? !{{ meta }} : {{ item.hide ? 'false' : 'true' }}"
            :label-col="{ {{ small }}: { span: {{ total_column }} }, {{ large }}: { span: {{ label_column }} }}"
            :wrapper-col="{ {{ small }}: { span: {{ total_column }} }, {{ large }}: { span: {{ wrapper_column }} }}"
            label="{{ item.label|trans({}, 'twig') }}"
            extra="{{ ((item.tips|trans({}, 'twig')) ~ ',' ~ item.tipsAuto)|trim(',') }}"
          >
            {% set title = ((item.title|trans({}, 'twig')) ~ ',' ~ item.titleAuto)|trim(',') %}
            {% set begin = title ? '<a-popover overlay-class-name="bsw-popover"><template slot="content">' ~ title ~ '</template>' : null %}
            {% set end = title ? '</a-popover>' : null %}
            {{ begin|raw }}
            {% include form.itemName|twig('form') %}
            {{ end|raw }}
          </a-form-item>
        </transition>
      {% endfor %}

      <a-form-item
        :wrapper-col="{
          {{ small }}: { span: {{ total_column }}, offset: 0 },
          {{ large }}: { span: {{ total_column - label_column }}, offset: {{ label_column }} }
        }"
      >
        {% for form in persistence.operates %}
          {% include 'button'|twig('form') %}
        {% endfor %}
      </a-form-item>
    </a-form>
  </div>
{% endblock %}

{% block javascript %}
{% include 'persistence'|twig('javascript', 'md') %}
{% endblock %}